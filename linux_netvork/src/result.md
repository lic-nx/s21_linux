# Сети в линукс

## Part 1. Инструмент **ipcalc**

- Адрес сети:  \
![адрес сети](screens/task1_net.png)
вывод с использованием ipcalc 192.167.38.54/13
перевод маски *255.255.255.0* в префиксную и двоичную запись,  \
![перевод маски](../src/screens/task1_trans.png) \
перевод /15 в обычную и двоичную     
![переввод15](../src/screens/task1_15.png)  \
перевод *11111111.11111111.11111111.11110000* в обычную и префиксную. Пишем 28 т.к.маска содержит в себе 28 единиц.  \
![перевод маски в обычную и префексную](screens/task1_ipcalc_28.png) 
- минимальный и максимальный хост для маски /8  \
![min and max for /8](screens/task1_minmax.png)  \
мнимальный и максимальный хост для маски 16  \
![min and max for /16](screens/task1_minMaxfor16.png)
минимальный и максимальный в сети 12.167.38.4 при маске 23
![min_max23](screens/task1_minmax_23.png) \
минимальный и максимальный в сети 12.167.38.4 при маске 4 \
![min_max_mask:4](screens/task1_minmax_4.png) 
- Для localhost зарезервирован диапазон ip 127.0.0.1 - 127.255.255.254. Поэтому обратиться к приложению, работающем на localhost с IP 194.34.23.100 и 128.0.0.1 мы не сможем, тогда как к IP 127.0.0.2 и 127.1.0.1 сможем.
- в качестве частных: 10.0.0.45, 192.168.4.2, 172.20.250.4, 172.16.255.255, 10.10.10.10 \
в качестве публичных: 134.43.0.2, 172.0.2.1, 192.172.0.1, 172.68.0.2, 192.169.168.1
- Возможные IP адреса шлюза: 10.10.0.2, 10.10.10.10, 10.10.1.255
## Part 2. Статическая маршрутизация между двумя машинами
- С помощью команды `ip a` посмотреть существующие сетевые интерфейсы
для ws1 \
![смотрим интерфейсы](screens/task2_ipa_1.png) \
для ws2 \
![смотрим интерфейс для машты 2](screens/task2_ipa_2.png)
- Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - *192.168.100.10*, маска */16*, ws2 - *172.24.116.8*, маска */12*
измененный файл *vi /etc/netplan/00-installer-config.yaml* для ws1 \
![изменненаяДля1йМашины](screens/task2_adres_wb1.png) \
измененный файл *etc/netplan/00-installer-config.yaml* для ws2 \
![изменненаяДля2йМашины](screens/task2_addres_wb2.png) \
- Выполнить команду `netplan apply` для перезапуска сервиса сети
netplan apply для ws1 \
![принятие netplan](screens/task2_netplan_wb1.png) \
netplan apply для ws2 \
![принятие netplan](screens/task2_netplan_wb2.png)
- Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r add`
добавление статического маршрута для ws1 \
![добавление статического маршрута](screens/task_2.1_add_id_for_wb1.png) \
Добавление статистического маршрута для ws2 \
![Добавление статистического маршрута](screens/task_2.1_ip_for_wb2.png) \
пропинговала соединение между раб.станциями. слева wm2 справа wm1 \
![соединение между рабочими станциями](screens/task2_ping.png)

- Добавить статический маршрут с сохранением 
слева ws1 справа ws2 используем sudo netplan apply
![используем sudo netplan apply](screens/task_2.2_via.png)

-пингуем машины \
пропинговка ws1
![пропинговка ws1](screens/task_2.2_ping_1wm.png) \
пропинговка ws2
![пропинговка ws2](screens/task_2.2_ping_2wm.png)

## Part 3. Утилита iperf3
Скорость соединения
- 8 Mpbs = 1 MB/s
- 100 MB/s = 800000 Kbps
- 1 Gbps = 1000 Mbps

-скорость соединения между ws1, установленной как сервер при помощи команды iperf3 -s с последующим измерением скорости соединения,
![скорость соединения между](screens/task_3.2_iperf3_1wbpng.png) \
и ws2 установленной как принимающее устройство с помощью команды iperf3 -c 192.168.100.10 -p 5201 с последующим измерением скорости соединения \
![ iperf3 ](screens/task_3.2_iperf3_wb2.png)

## Part 4. Сетевой экран
- создание файла имитирующего фаерволл для ws1 \
![имитирующего фаерволл](screens/task_4.1_wb1.png) \
создание файла имитирующего фаерволл для ws2 \
![имитирующего фаерволл](screens/task_4.1_wb2.png) 
- на ws1 применить стратегию когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило
- на ws2 применить стратегию когда в началк пишется разрешающее правило, а в конце пишется запрещающее слово
- открыть на раб. станциях 
на скриншоте справа ws1, слева - ws2 \
![справа ws1, слева - ws2](screens/task_4.1.1_iptables.png) \
Результат выполнения команды chmod +x /etc/firewall.sh и /etc/firewall.sh 
![Результат выполнения команды](screens/task4.1.3.png)
- Разница в стратегиях: \
На ws2 мы сначала разрешили пинг а потом запретили пинг. Так как мы написали его раньше запрещающего, то пинг разрешен. 
В то время как на ws1 мы написали сначала запрет и потом разрешение. Следовательно пинг не будет разрешен 
- 4.2 Утилита nmap \
мы не смогли пропинговать ws2. Но можно увидеть, что подключение к хосту есть 
![подключение к хосту](screens/task4.2ping2mashin.png) \
пинг ws1 \
![пинг ws1](screens/task4.2ping1mashin.png)
## Part 5. Статическая маршрутизаия
- Содержание файла etc/netplan/00-installer-config.yaml для  ws1 \
![Содержание файла](screens/task5_w1.png) \
Содержание файла etc/netplan/00-installer-config.yaml для  ws2 \
![Содержание файла](screens/task5_w2.png) \
Содержание файла etc/netplan/00-installer-config.yaml для ws22 \
![Содержание файла](screens/task5_w22.png) \
Содержание файла etc/netplan/00-installer-config.yaml для r1 \
![Содержание файла](screens/task5_r1.png)
Содержание файла etc/netplan/00-installer-config.yaml для r2 \
![Содержание файла](screens/task5_r2.png)
- Настройка адресов раб. станций \
проверка адресов на ws11 \
![проверка адресов](screens/task5_1_m1.png) \
проверка адресов на ws21 \
![проверка адресов](screens/task5_1_m2.png) \
проверка адресов на ws22 \
![проверка адресов](screens/task5_1_m22.png) \
проверка адресов на r1 \
![проверка адресов](screens/task5_1_r1.png) \
проверка адресов на сервере r2 \
![проверка адресов](screens/task5_1_r2.png) \
- включение переадресации IP-адресса
![включение переадресации](screens/task5_2_sysct.png) \
Откройте файл /etc/sysctl.conf и добавьте в него следующую строку:
net.ipv4.ip_forward = 1 \
для первого роутера \
![для первого роутера](screens/task5.2_r1.png) \
для второго роутера \
![для второго роутера](screens/task5.2_r2.png)
- 5.3. Установка маршрута по-умолчанию
![](screens/task5.3_w11_ip_r.png) \
![](screens/task5.3_ws21_ip_r.png) \
![](screens/task5.3_ws2_ip_r.png) \
![](screens/task5.3_ws11_ping.png) \
![](screens/task5.3_ping_r2.png) 

- 5.4. Добавление статических маршрутов \
добавление маршрутов для r1 и r2 \
![добавление маршрутов](screens/task5.4_netplan.png) \
просмотр списков для r1 b r2
![просмотр списков](screens/task5.4_ip_r.png) \
просмотр спискв для ws11
![просмотр списков](screens/task5.4_ip_r_list.png) 
- почему для адреса 10.10.0.0/[маска сети] был выбран маршрут, отличный от 0.0.0.0/0, хотя он попадает под маршрут по-умолчанию. \
Так как приоритетно выбирается маршрут с более длинной маской

- 5.5. Построение списка маршрутизаторов
вывода утилиты traceroute после добавления шлюза:
![вывода утилиты traceroute](screens/task5.6_icmp.png)

## Part 6. Динамическая настройка IP с помощью DHCP
указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2 \
![файла для r2](screens/task6.1_dhcp.png) \
в файле resolv.conf прописать nameserver 8.8.8.8. \
![файле resolv.conf](screens/task6.1_nameserver.png) \
Перезагрузить службу DHCP командой systemctl restart isc-dhcp-server
![Перезагрузить службу DHCP](screens/task6.2_sys_rest.png)
перезапуск машины ws21 и выдача ему нового адреса \
![перезапуск  ws21(screens/task6.1_w21.png) \
пинг двух раб.станций \
![пинг двух машин](screens/task6.2_ping_w21_w22.png) \
Указать MAC адрес у ws11 \
![MAC адрес у ws11](screens/task6.1_mackaddres.png)  
r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). 
![выдачу адресов с жесткой привязкой](screens/task6.2_r1_dhcp.png) \
в файле resolv.conf прописать nameserver 8.8.8.8. \
![файле resolv.conf](screens/task6.2_maneserver.png) \
применение 
![применение](screens/task6.2_r1_restart.png)
ip a для  ws11
 ![ip a для машины](screens/task6.2_mak_ip_a.png) 
ip для ws21 до того как обновили адрес \
![до того как обновили адрес](screens/task6.2_ws21_ip_befor_update.png)
ip для ws21 после того как обновили адрес \
![после того как обновили адрес](screens/task6.3_ws22_dhclient.png) \
для данного пункта использовала sudo dhclient enp0s8. При запуске dhclient читает dhclient.conf для получения инструкций по настройке.
## Part 7. NAT
В файле /etc/apache2/ports.conf на r1 изменить строку Listen 80 на Listen 0.0.0.0:80 \
![изменить строку Listen 80](screens/task7.1_r1.png) \

В файле /etc/apache2/ports.conf на ws22 изменить строку Listen 80 на Listen 0.0.0.0:80 \
![В файле ws22 ](screens/task7.1_ws22.png) \
Запустить веб-сервер Apache командой service apache2 start на ws22 \
![Запустить веб-сервер Apache](screens/task7.1_apache_ws22.png) \
Запустить веб-сервер Apache командой service apache2 start на r1 \
![Запустить веб-сервер Apache](screens/task7.2_apache_r1.png) \
Добавить в фаервол, на r2 следующие правила \
![Добавить в фаервол](screens/task7.1_fireval_r2.png) \
запуск файерволла \
![запуск файерволла](screens/task7.1_r2_apply_firevall.png) \
Проверить соединение между ws22 и r1 командой ping \
![Проверить соединение](screens/task7.2_ping_r1_ws22.png) \
станции не пингуются друг с другом 
- Разрешить маршрутизацию всех пакетов протокола ICMP

![Разрешить маршрутизацию](screens/task7.4_firevall_r2.png) \
пропинговали r1 и ws22 \
![пропинговали](screens/task7.4_ping_r1_ws22.png)
- Включить SNAT, а именно маскирование всех локальных ip из локальной сети, находящейся за r2 (по обозначениям из Части 5 - сеть 10.20.0.0)
![Включить SNAT](screens/task7.5_SNAT_r2.png) \
добавление DNAT
![добавление DNAT](screens/task7.6_DNAT_r2.png)
проверить соединение по TCP для SNAT \
проверяем соединение ws22 - r1 \
![проверить соединение](screens/task7.7_ws22_telnet.png) \
проверяем соединение r1 - ws22 \
![проверяем соединение](screens/task7.7_telnet_r1_ws22.png)
## task 8
- Запустить веб-сервер Apache на ws22 только на localhost 
![апустить веб-сервер](screens/task8.1_ws22_apache2.png)
- Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21 \
![Воспользоваться Local TCP](screens/task7.2L.png) \
- оспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11 \
![оспользоваться Remote TCP forwarding](screens/task7.2R.png) \
telnet \
![telnet](screens/task7.4_telnet.png)